<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>循環シミュレーター</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9841073099638539"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app-container">
        <!-- ヘッダー -->
        <header class="header">
            <h1>循環シミュレーター</h1>
            <div class="controls">
                <button id="startBtn" class="btn btn-primary">▶ スタート</button>
                <button id="resetBtn" class="btn btn-secondary">↺ リセット</button>
                <div class="speed-control">
                    <label>速度: <span id="speedValue" class="speed-value">1</span>x</label>
                    <input type="range" id="speedSlider" min="0" max="100" value="50" step="1">
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- グラフエリア -->
            <main class="charts-area">
                <!-- モニター + パラメータ -->
                <div class="monitor-section">
                    <aside class="params-panel" id="paramsPanel">
                        <div class="params-tabs">
                            <button type="button" class="params-tab is-active" data-tab="simple">簡易操作</button>
                            <button type="button" class="params-tab" data-tab="params">詳細</button>
                            <button type="button" class="params-tab" data-tab="settings">表示設定</button>
                            <button type="button" class="params-tab" data-tab="save">描画保存</button>
                        </div>

                        <div class="params-tab-content is-active" data-tab-content="simple">
                            <div class="param-select">
                                <label for="simpleGroupSelect">項目</label>
                                <select id="simpleGroupSelect">
                                    <option value="basic" selected>基本項目</option>
                                    <option value="valvular">弁膜症</option>
                                    <option value="preset">疾患プリセット</option>
                                </select>
                            </div>

                            <div class="param-section simple-group is-active" data-simple-group="basic">
                                <div class="param-content">
                                    <div class="param-row">
                                        <label>調律</label>
                                        <select id="simple-rhythm">
                                            <option value="sinus" selected>洞調律</option>
                                            <option value="junctional">接合部調律</option>
                                        </select>
                                    </div>
                                    <div class="param-row">
                                        <label>HR (bpm)</label>
                                        <input type="number" id="simple-hr" value="75" min="30" max="200">
                                    </div>
                                    <div class="param-row">
                                        <label>前負荷(静脈圧)</label>
                                        <input type="number" id="simple-pv" value="8" step="1" min="0" max="30">
                                    </div>
                                    <div class="param-row">
                                        <label>左室収縮力 (Ees)</label>
                                        <input type="number" id="simple-lv-ees" value="2.3" step="0.1" min="0.5" max="5">
                                    </div>
                                    <div class="param-row">
                                        <label>左室拡張能(EDPVR)</label>
                                        <input type="number" id="simple-lv-alpha" value="0.03" step="0.01" min="0.01" max="0.2">
                                    </div>
                                    <div class="param-row">
                                        <label>後負荷 (SVR)</label>
                                        <input type="number" id="simple-svr" value="1200" step="50" min="400" max="4000">
                                    </div>
                                    <div class="param-row">
                                        <label>大動脈コンプライアンス</label>
                                        <input type="number" id="simple-ca" value="1.5" step="0.1" min="0.5" max="5">
                                    </div>
                                    <div class="param-note">
                                        ※左室拡張能(EDPVR)は(+)で拡張能が低下します。<br>
                                        ※大動脈コンプライアンスは(-)で動脈硬化が進行します。
                                    </div>
                                </div>
                            </div>

                            <div class="param-section simple-group" data-simple-group="valvular">
                                <div class="param-content">
                                    <div class="param-row">
                                        <label>AS</label>
                                        <select id="simple-as">
                                            <option value="none" selected>なし</option>
                                            <option value="mild">軽症</option>
                                            <option value="moderate">中等症</option>
                                            <option value="severe">重症</option>
                                        </select>
                                    </div>
                                    <div class="param-row">
                                        <label>AR</label>
                                        <select id="simple-ar">
                                            <option value="none" selected>なし</option>
                                            <option value="mild">軽症</option>
                                            <option value="moderate">中等症</option>
                                            <option value="severe">重症</option>
                                        </select>
                                    </div>
                                    <div class="param-row">
                                        <label>MS</label>
                                        <select id="simple-ms">
                                            <option value="none" selected>なし</option>
                                            <option value="mild">軽症</option>
                                            <option value="moderate">中等症</option>
                                            <option value="severe">重症</option>
                                        </select>
                                    </div>
                                    <div class="param-row">
                                        <label>MR</label>
                                        <select id="simple-mr">
                                            <option value="none" selected>なし</option>
                                            <option value="mild">軽症</option>
                                            <option value="moderate">中等症</option>
                                            <option value="severe">重症</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="param-section simple-group" data-simple-group="preset">
                                <div class="param-content">
                                    <div class="param-row">
                                        <label>疾患プリセット</label>
                                        <select id="presetSelect">
                                            <option value="">読み込み中...</option>
                                        </select>
                                    </div>
                                    <div class="preset-admin">
                                        <div class="preset-admin-auth" id="presetAdminAuth">
                                            <input type="password" id="presetAdminToken" placeholder="管理者パスワード">
                                            <button type="button" id="presetAdminLoginBtn" class="btn btn-secondary">管理者モード</button>
                                        </div>
                                        <div class="preset-admin-panel" id="presetAdminPanel" hidden>
                                            <div class="preset-admin-fields">
                                                <input type="text" id="presetName" placeholder="プリセット名">
                                                <textarea id="presetDescription" rows="2" placeholder="説明（任意）"></textarea>
                                            </div>
                                            <div class="preset-admin-actions">
                                                <button type="button" id="presetSaveBtn" class="btn btn-primary">新規保存</button>
                                                <button type="button" id="presetUpdateBtn" class="btn btn-secondary">更新</button>
                                                <button type="button" id="presetDeleteBtn" class="btn btn-secondary">削除</button>
                                                <button type="button" id="presetAdminLogoutBtn" class="btn btn-secondary">ログアウト</button>
                                            </div>
                                            <div class="preset-admin-hint">
                                                現在の設定をプリセットとして保存/更新します。
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="params-tab-content" data-tab-content="params">
                            <div class="param-select">
                                <label for="paramGroupSelect">項目</label>
                                <select id="paramGroupSelect">
                                    <option value="heart" selected>心拍</option>
                                    <option value="vein">静脈</option>
                                    <option value="la">左房</option>
                                    <option value="mitral">僧帽弁</option>
                                    <option value="lv">左室</option>
                                    <option value="aortic-valve">大動脈弁</option>
                                    <option value="aorta">大動脈</option>
                                </select>
                            </div>

                            <div class="param-section param-group" data-group="heart">
                                <div class="param-section-header">心拍</div>
                                <div class="param-content">
                                    <div class="param-row">
                                        <label>HR (bpm)</label>
                                        <input type="number" id="param-hr" value="75" min="30" max="200">
                                    </div>
                                    <div class="param-row">
                                        <label>PR間隔 (sec)</label>
                                        <input type="number" id="param-pr" value="0.15" step="0.01" min="-0.2" max="0.3">
                                    </div>
                                </div>
                            </div>

                            <div class="param-section param-group" data-group="vein">
                                <div class="param-section-header">静脈</div>
                                <div class="param-content">
                                    <div class="param-row">
                                    <label>静脈圧(mmHg)</label>
                                        <input type="number" id="param-pv" value="8" step="1" min="0" max="30">
                                    </div>
                                    <div class="param-row">
                                    <label>静脈抵抗(mmHg·s/mL)</label>
                                        <input type="number" id="param-rv" value="0.05" step="0.001" min="0.001" max="0.1">
                                    </div>
                                </div>
                            </div>

                            <div class="param-section param-group" data-group="la">
                                <div class="param-section-header">左房</div>
                                <div class="param-content">
                                    <div class="param-row">
                                        <label>左房収縮</label>
                                        <select id="param-la-contraction">
                                            <option value="on" selected>あり</option>
                                            <option value="off">なし</option>
                                        </select>
                                    </div>
                                    <div class="param-row">
                                        <label>LA Ees (mmHg/mL)</label>
                                        <input type="number" id="param-la-ees" value="0.25" step="0.01" min="0.05" max="1">
                                    </div>
                                    <div class="param-row">
                                    <label>左房EDPVR α(mmHg)</label>
                                        <input type="number" id="param-la-alpha" value="0.12" step="0.01" min="0.01" max="1">
                                    </div>
                                    <div class="param-row">
                                    <label>左房EDPVR β(1/mL)</label>
                                        <input type="number" id="param-la-beta" value="0.05" step="0.01" min="0.01" max="0.2">
                                    </div>
                                    <div class="param-row">
                                        <label>LA V0 (mL)</label>
                                        <input type="number" id="param-la-v0" value="0" step="1" min="0" max="20">
                                    </div>
                                </div>
                            </div>

                            <div class="param-section param-group" data-group="mitral">
                                <div class="param-section-header">僧帽弁</div>
                                <div class="param-content">
                                    <div class="param-row">
                                        <label>MS</label>
                                        <select id="param-ms">
                                            <option value="off" selected>なし</option>
                                            <option value="on">あり</option>
                                        </select>
                                    </div>
                                    <div class="param-row">
                                        <label>MVA (cm^2)</label>
                                        <input type="number" id="param-ms-mva" value="1.5" step="0.1" min="0.2" max="5">
                                    </div>
                                    <div class="param-row">
                                        <label>MVA 正常 (cm^2)</label>
                                        <input type="number" id="param-mv-area" value="4.0" step="0.1" min="1" max="8">
                                    </div>
                                    <div class="param-row">
                                        <label>MR</label>
                                        <select id="param-mr">
                                            <option value="off" selected>なし</option>
                                            <option value="on">あり</option>
                                        </select>
                                    </div>
                                    <div class="param-row">
                                        <label>MR EROA (cm^2)</label>
                                        <input type="number" id="param-mr-eroa" value="0.2" step="0.01" min="0" max="5">
                                    </div>
                                    <div class="param-row">
                                    <label>MR逆流係数(Cd)</label>
                                        <input type="number" id="param-mr-cd" value="0.75" step="0.01" min="0.1" max="1.2">
                                    </div>
                                    <div class="param-row">
                                    <label>僧帽弁抵抗(mmHg·s/mL)</label>
                                        <input type="number" id="param-rm" value="0.01" step="0.001" min="0.001" max="0.1">
                                    </div>
                                    <div class="param-row">
                                    <label>僧帽弁慣性(mmHg·s²/mL)</label>
                                        <input type="number" id="param-lm" value="0.0001" step="0.0001" min="0.0001" max="0.01">
                                    </div>
                                </div>
                            </div>

                            <div class="param-section param-group" data-group="lv">
                                <div class="param-section-header">左室</div>
                                <div class="param-content">
                                    <div class="param-row">
                                        <label>LV Ees (mmHg/mL)</label>
                                        <input type="number" id="param-lv-ees" value="2.3" step="0.1" min="0.5" max="5">
                                    </div>
                                    <div class="param-row">
                                    <label>左室EDPVR α(mmHg)</label>
                                        <input type="number" id="param-lv-alpha" value="0.03" step="0.01" min="0.01" max="0.2">
                                    </div>
                                    <div class="param-row">
                                    <label>左室EDPVR β(1/mL)</label>
                                        <input type="number" id="param-lv-beta" value="0.05" step="0.01" min="0.01" max="0.2">
                                    </div>
                                    <div class="param-row">
                                        <label>LV V0 (mL)</label>
                                        <input type="number" id="param-lv-v0" value="0" step="1" min="0" max="20">
                                    </div>
                                </div>
                            </div>

                            <div class="param-section param-group" data-group="aortic-valve">
                                <div class="param-section-header">大動脈弁</div>
                                <div class="param-content">
                                    <div class="param-row">
                                        <label>AS</label>
                                        <select id="param-as">
                                            <option value="off" selected>なし</option>
                                            <option value="on">あり</option>
                                        </select>
                                    </div>
                                    <div class="param-row">
                                        <label>AVA (cm^2)</label>
                                        <input type="number" id="param-as-ava" value="1.5" step="0.1" min="0.2" max="5">
                                    </div>
                                    <div class="param-row">
                                        <label>AR</label>
                                        <select id="param-ar">
                                            <option value="off" selected>なし</option>
                                            <option value="on">あり</option>
                                        </select>
                                    </div>
                                    <div class="param-row">
                                        <label>AR EROA (cm^2)</label>
                                        <input type="number" id="param-ar-eroa" value="0.3" step="0.01" min="0" max="5">
                                    </div>
                                    <div class="param-row">
                                    <label>AR逆流係数(Cd)</label>
                                        <input type="number" id="param-ar-cd" value="0.88" step="0.01" min="0.1" max="1.2">
                                    </div>
                                    <div class="param-row">
                                    <label>大動脈弁抵抗(mmHg·s/mL)</label>
                                        <input type="number" id="param-ra" value="0.02" step="0.001" min="0.001" max="0.1">
                                    </div>
                                    <div class="param-row">
                                    <label>大動脈弁慣性(mmHg·s²/mL)</label>
                                        <input type="number" id="param-la-inert" value="0.0001" step="0.0001" min="0.0001" max="0.01">
                                    </div>
                                </div>
                            </div>

                            <div class="param-section param-group" data-group="aorta">
                                <div class="param-section-header">大動脈</div>
                                <div class="param-content">
                                    <div class="param-row">
                                    <label>大動脈コンプライアンス(mL/mmHg)</label>
                                        <input type="number" id="param-ca" value="1.5" step="0.1" min="0.5" max="5">
                                    </div>
                                    <div class="param-row">
                                        <label>Ao Area (cm^2)</label>
                                        <input type="number" id="param-ao-area" value="4.0" step="0.1" min="1" max="10">
                                    </div>
                                    <div class="param-row">
                                        <label>SVR (dyn·s/cm⁵)</label>
                                        <input type="number" id="param-svr" value="1200" step="50" min="400" max="4000">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="params-tab-content" data-tab-content="settings">
                            <div class="modal-section">
                                <h4>波形表示項目</h4>
                                <div class="toggle-grid">
                                    <label><input type="checkbox" class="waveform-toggle" value="art" checked> ART</label>
                                    <label><input type="checkbox" class="waveform-toggle" value="lvp" checked> LVP</label>
                                    <label><input type="checkbox" class="waveform-toggle" value="lap" checked> LAP</label>
                                    <label><input type="checkbox" class="waveform-toggle" value="avFlow" checked> AV flow</label>
                                    <label><input type="checkbox" class="waveform-toggle" value="mvFlow" checked> MV flow</label>
                                    <label><input type="checkbox" class="waveform-toggle" value="pvFlow" checked> PV flow</label>
                                    <label><input type="checkbox" class="waveform-toggle" value="laElastance" checked> LA elastance</label>
                                    <label><input type="checkbox" class="waveform-toggle" value="lvElastance" checked> LV elastance</label>
                                </div>
                            </div>
                            <div class="modal-section">
                                <h4>モニタースケール</h4>
                                <div class="modal-grid">
                                    <label>圧 Max (LV/AO)
                                        <input type="number" class="scale-input" id="monitor-pressure-lv-ao-max" value="150" step="10" min="50" max="300">
                                    </label>
                                    <label>圧 Max (LA)
                                        <input type="number" class="scale-input" id="monitor-pressure-la-max" value="40" step="5" min="5" max="80">
                                    </label>
                                    <label>Flow Max
                                        <input type="number" class="scale-input" id="scale-flow-max" value="1200" step="100" min="200" max="2000">
                                    </label>
                                    <label>Flow Min
                                        <input type="number" class="scale-input" id="scale-flow-min" value="-200" step="50" min="-500" max="0">
                                    </label>
                                    <label>E Max
                                        <input type="number" class="scale-input" id="scale-elastance-max" value="3" step="0.5" min="1" max="10">
                                    </label>
                                </div>
                            </div>
                            <div class="modal-section">
                                <h4>PVループスケール</h4>
                                <div class="modal-grid">
                                    <label>LA V Max
                                        <input type="number" class="scale-input" id="la-pv-vmax" value="120" min="20" max="200">
                                    </label>
                                    <label>LA P Max
                                        <input type="number" class="scale-input" id="la-pv-pmax" value="40" min="5" max="50">
                                    </label>
                                    <label>LV V Max
                                        <input type="number" class="scale-input" id="lv-pv-vmax" value="150" min="50" max="300">
                                    </label>
                                    <label>LV P Max
                                        <input type="number" class="scale-input" id="lv-pv-pmax" value="200" min="50" max="300">
                                    </label>
                                </div>
                            </div>
                            <div class="modal-section">
                                <h4>CO曲線スケール</h4>
                                <div class="modal-grid">
                                    <label>X Max (Pv)
                                        <input type="number" class="scale-input" id="balance-x-max" value="20" step="1" min="5" max="50">
                                    </label>
                                    <label>Y Max (CO/VR)
                                        <input type="number" class="scale-input" id="balance-y-max" value="12" step="1" min="4" max="20">
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="params-tab-content" data-tab-content="save">
                            <div class="save-controls">
                                <div class="save-form" id="saveDrawingForm">
                                    <input type="text" id="saveDrawingName" maxlength="20" placeholder="保存名 (任意)">
                                    <button type="button" id="saveDrawingBtn" class="btn btn-primary">保存</button>
                                    <button type="button" id="cancelSaveDrawingBtn" class="btn btn-secondary">取消</button>
                                </div>
                            </div>
                            <div id="savedDrawingList" class="saved-drawing-list"></div>
                        </div>
                    </aside>

                    <!-- 生体モニターセクション -->
                    <div class="vital-monitor">
                        <div class="monitor-vitals">
                            <div class="vital-item vital-hr" data-vital-item="hr">
                                <span class="vital-label">HR</span>
                                <span class="vital-value" id="vital-hr">75</span>
                            </div>
                            <div class="vital-item vital-bp" data-vital-item="art">
                                <span class="vital-label">ART</span>
                                <span class="vital-values">
                                    <span class="vital-value" id="vital-sys">120</span>/<span class="vital-value vital-dia"
                                        id="vital-dia">80</span>(<span id="vital-map">93</span>)
                                </span>
                            </div>
                            <div class="vital-item vital-lap" data-vital-item="lap">
                                <span class="vital-label">LAP</span>
                                <span class="vital-values">
                                    <span class="vital-value" id="vital-lap-max">12</span>/<span
                                        class="vital-value vital-dia" id="vital-lap-min">5</span>(<span
                                        id="vital-lap-mean">8</span>)
                                </span>
                            </div>
                            <div class="vital-item vital-lvp" data-vital-item="lvp">
                                <span class="vital-label">LVP</span>
                                <span class="vital-values">
                                    <span class="vital-value" id="vital-lvp-max">120</span>/<span
                                        class="vital-value vital-dia" id="vital-lvp-min">5</span>(<span
                                        id="vital-lvp-mean">40</span>)
                                </span>
                            </div>
                            <div class="vital-item vital-other" data-vital-item="co">
                                <span class="vital-label">CO</span>
                                <span class="vital-value" id="vital-co">5.0</span>
                            </div>
                            <div class="vital-item vital-other" data-vital-item="sv">
                                <span class="vital-label">SV</span>
                                <span class="vital-value" id="vital-sv">70</span>
                            </div>
                            <div class="vital-item vital-other" data-vital-item="svr">
                                <span class="vital-label">SVR</span>
                                <span class="vital-value" id="vital-svr">1200</span>
                            </div>
                            <div class="vital-item vital-other" data-vital-item="lvedp">
                                <span class="vital-label">LVEDP</span>
                                <span class="vital-value" id="vital-lvedp">8</span>
                            </div>
                        </div>
                        <div class="monitor-waveforms">
                            <!-- 心電図 -->
                            <div class="monitor-row">
                                <canvas id="chart-ecg"></canvas>
                            </div>
                            <!-- 圧波形 -->
                            <div class="monitor-row monitor-row-large">
                                <canvas id="chart-pressure"></canvas>
                            </div>
                            <!-- 弁Flow -->
                            <div class="monitor-row">
                                <canvas id="chart-flow"></canvas>
                            </div>
                            <!-- エラスタンス -->
                            <div class="monitor-row monitor-row-small">
                                <canvas id="chart-elastance"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- その他のグラフ -->
                <div class="charts-grid">

                    <!-- 左房PVループ -->
                    <div class="chart-container">
                        <h3>左房 PVループ</h3>
                        <canvas id="chart-la-pv"></canvas>
                    </div>

                    <!-- 左室PVループ -->
                    <div class="chart-container">
                        <h3>左室 PVループ</h3>
                        <canvas id="chart-lv-pv"></canvas>
                    </div>

                    <!-- 循環平衡（CO/VR） -->
                    <div class="chart-container balance-chart">
                        <div class="balance-header">
                            <h3>CO曲線</h3>
                            <button type="button" id="drawBalanceCurveBtn" class="btn btn-secondary">曲線を表示</button>
                        </div>
                        <canvas id="chart-balance"></canvas>
                    </div>
                </div>


            </main>
        </div>
    </div>

    <script src="js/constants.js"></script>
    <script src="js/simulation.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/main.js"></script>
</body>

</html>
